<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.wolfking.jeesite.modules.fi.dao.ServicePointInvoiceMonthlyDao">
	<insert id="insert" parameterType="ServicePointInvoiceMonthly">
		INSERT INTO
			fi_servicepoint_payable_monthly
		(
			id,
			servicepoint_id,
			payment_type,
			`year`
		)
		VALUES
		(
			#{id},
			#{servicePoint.id},
			#{paymentType},
			#{year}
		);
		INSERT INTO
			fi_servicepoint_paid_monthly
		(
			id,
			servicepoint_id,
			payment_type,
			`year`
		)
		VALUES
		(
			#{id},
			#{servicePoint.id},
			#{paymentType},
			#{year}
		);
		INSERT INTO
			fi_servicepoint_invoice_monthly
		(
			id,
			servicepoint_id,
			payment_type,
			`year`
		)
		VALUES
		(
			#{id},
			#{servicePoint.id},
			#{paymentType},
			#{year}
		);
		INSERT INTO
			rpt_servicepoint_balance_monthly
		(
			id,
			servicepoint_id,
			payment_type,
			`year`
		)
		VALUES
		(
			#{id},
			#{servicePoint.id},
			#{paymentType},
			#{year}
		);
	</insert>

	<select id="getOneId" parameterType="ServicePointInvoiceMonthly" resultType="Long">
		SELECT
			id
		FROM
			fi_servicepoint_invoice_monthly
		WHERE
			servicepoint_id = #{servicePoint.id}
		AND year = #{year}
		AND payment_type = #{paymentType}
		LIMIT 1;
	</select>

	<update id="incrAmount" parameterType="ServicePointInvoiceMonthly">
        INSERT INTO fi_servicepoint_invoice_monthly (
				id,
				servicepoint_id,
				payment_type,
				`year`,
				${monthField}
		) VALUES (
				#{id},
				#{servicePoint.id},
				#{paymentType},
				#{year},
				#{amount}
		)
		ON DUPLICATE KEY
		UPDATE ${monthField} = ${monthField} + #{amount}
	</update>

</mapper>
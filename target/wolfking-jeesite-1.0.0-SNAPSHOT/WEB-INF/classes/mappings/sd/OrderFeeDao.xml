<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.wolfking.jeesite.modules.sd.dao.OrderFeeDao">

	<!-- 对账后更新财务网点其他扣费 -->
	<update id="updateFeeAfterCharge">
		update
			sd_order_fee
		<set>
			engineer_tax_fee = #{engineerTaxFee},
			engineer_info_fee = #{engineerInfoFee},
			engineer_deposit = #{engineerDeposit},
			engineer_total_charge = engineer_total_charge + #{engineerTaxFee} + #{engineerInfoFee} + #{engineerDeposit},
		</set>
		where
			order_id = #{orderId}
			and quarter = #{quarter}
	</update>

	<!-- 更新好评费 -->
	<update id="updatePraiseFee">
		update
			sd_order_fee
		<set>
			<if test="praiseFee != null">
			praise_fee = #{praiseFee},
			order_charge = service_charge
					+ express_charge
					+ travel_charge
					+ material_charge
					+ other_charge
					+ customer_urgent_charge
					+ customer_time_liness_charge
					+ #{praiseFee},
			</if>
			<if test="engineerPraiseFee != null">
				engineer_praise_fee = #{engineerPraiseFee},
				engineer_total_charge = engineer_service_charge
					+ engineer_express_charge
					+ engineer_travel_charge
					+ engineer_material_charge
					+ engineer_other_charge
					+ engineer_urgent_charge
					+ time_liness_charge
				    + subsidy_time_liness_charge
					+ insurance_charge
					+ engineer_info_fee
					+ engineer_tax_fee
					+ engineer_deposit
					+ #{engineerPraiseFee}
			</if>
		</set>
		where
			order_id = #{orderId}
			and quarter = #{quarter}
	</update>

</mapper>